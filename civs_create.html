<html>

<head>
<meta http-equiv="Content-Type" content="text/html">
<meta name="GENERATOR" content="Microsoft FrontPage 4.0">
<meta name="ProgId" content="FrontPage.Editor.Document">
<meta http-equiv="Content-Script-Type" content="text/javascript">
<title>Condorcet Internet Voting Service</title>
<link rel="stylesheet" type="text/css" href="@CIVSURL@/style.css" />
<meta http-equiv="Content-Script-Type" content="text/javascript">
<script type="text/javascript">
    function trim(str)
    {
        return str.replace(/^\s+|\s+$/g, '')
    };
    function validateEmail(str)   // element to be validated
    {
	var str = trim(str);  // value of field with whitespace trimmed off
	var email = /^[^@]+@[^@.]+\.[^@]*\w\w$/
	return email.test(str);
    };

    function validate() {
	var numerrs = 0;
	var errs = new Array;
	if (!validateEmail(document.forms.CreateElection.email_addr.value)) {
	    errs[numerrs++] = 'Supervisor email address is invalid.';
	}
	if (!(document.forms.CreateElection.num_winners.value >= 1)) {
	    errs[numerrs++] = 'Must have at least one winner.';
	}
	if (document.forms.CreateElection.proportional.checked &&
	    !(document.forms.CreateElection.num_winners.value > 1)) {
	    errs[numerrs++] =
		'Proportional representation requires more than one winner.';
	}
	if (document.forms.CreateElection.choices.value == '' &&
	    document.forms.CreateElection.choices_file.value == '') {
	    errs[numerrs++] = 'Must have at least two choices to vote on.';
	}
	if (document.forms.CreateElection.restrict_results.checked) {
	    var rs = document.forms.CreateElection.result_addrs.value;
	    var ra = rs.split(/[\r\n]+/g);
	    var nr = 0;
	    for (i = 0; i < ra.length; i++) {
		if (ra[i] == '') continue;
		if (!validateEmail(ra[i])) {
		    errs[numerrs++] =
			'Results recipient email address is invalid: ' + ra[i];
		} else {
		    nr++;
		}
	    }
	    if (nr == 0) {
		errs[numerrs++] =
		    'You have specified no users who can see the election results.';
	    }
	}
	if (numerrs == 0) return true;
	if (numerrs == 1) {
	    alert(errs[0]);
	} else {
	    var msg = 'Errors:\n';
	    for (i = 0; i < numerrs; i++) {
		msg += (i+1);
		msg += '. ';
		msg += errs[i];
		msg += "\n";
	    }
	    alert(msg);
	}
	return false;
    }

    var prcontrol, prparent;
    var rvcontrol, rvparent;
    var rrcontrol, rrparent;

    function setup() {
	prcontrol = document.getElementById("prcontrol");
	prparent = prcontrol.parentNode;
	prparent.removeChild(prcontrol);

	rvcontrol = document.getElementById("reveal_voters");
	rvparent = rvcontrol.parentNode;
	rvparent.removeChild(rvcontrol);

        rrcontrol = document.getElementById("rrcontrol");
	rrparent = rrcontrol.parentNode;
	rrparent.removeChild(rrcontrol);
    }

    function render_text(prefix, ta_id, span_id) {
	var span = document.getElementById(span_id);
	var ta = document.getElementById(ta_id);
	span.innerHTML =  prefix + ta.value;
	return 1;
    }

    function render_list(ta_id, span_id) {
	var span = document.getElementById(span_id);
	var ta = document.getElementById(ta_id);
	var names = ta.value.split(/[\r\n]+/g);
	var html = "";
	for (i = 0; i < names.length; i++) {
	    html = html + "<li>" + names[i] + "</li>";
	}
	span.innerHTML = "<ul>" + html + "</ul>";
	return 1;
    }
</script>

</head>

<body>

<table class="banner" border="0" width="100%" cellspacing="0" cellpadding="7">
  <tbody><tr>
    <td width="100%" valign="top" nowrap>
      <h1>&nbsp;Condorcet Internet Voting
      Service</h1>
    </td>
    <td width=0% nowrap valign=top align=right>
	<a href="@CIVSHOME@">CIVS Home</a><br>
	<a href="@CIVSURL@/civs_create.html">Create new election</a><br>
	<a href="@CIVSURL@/sec_priv.html">About security and privacy</a><br>
	<a href="@CIVSURL@/faq.html">FAQ</a>
    </td>
  </tr>
  <tr>
    <td width="100%" valign="top" nowrap colspan=2>
      <h2 align="center">Create a New Election</h2>
    </td>
  </tr>
</tbody>
</table>

<div class="contents">

<p>This web page allows you to create a new CIVS election. You will be   
the supervisor of the election you create.</p>                          

<hr>
<form method="POST"
    action="@CIVSBINURL@/create_election@PERLEXT@"
    enctype="multipart/form-data"
    name="CreateElection"
    onsubmit="return validate()">
  <table class="form">
  <tr>
    <td align=right>Name of the election (e.g., <b>The Democratic Primary</b>):</td>
    <td><input type="text" name="title" size="50"></td>
  <tr>
    <td align=right>Your name:</td>
    <td><input type="text" name="name" size="20">
  </td>
  <tr>
    <td align=right>Your e-mail address:</td>
    <td><input type="text" name="email_addr" size="20"
      onchange="if (!validateEmail(this.value)) { alert('Invalid email address') }" >
    </td>
  </tr>
  <tr>
    <td align=right>The day and time when you plan to stop the election:
	<small>(<b>Note:</b> election must be stopped manually)</small>
    </td>
    <td><input type="text" name="election_end" id="election_end" size="30"
          onchange="render_text('<br><i>Preview</i>: Election ends ', 'election_end', 'rendered_end')">
	 <span class="rendering" id="rendered_end"></span>
</td>
  </tr>
  </table>

<div class="emphasized">
  <strong>Note:</strong>
  Your name and e-mail address are used when sending e-mail to
  voters. Your name should be recognizable to voters, and the e-mail
  address must work because CIVS emails you the information needed to
  control the election. If you have a spam service filtering your mail,
  make sure that it will not block mail from <tt>@SUPERVISOR@</tt>.
  </div>

  <p>Description of the election and available choices (may include HTML):<br>
  <table class="form">
    <tr>
      <td><textarea id="description" valign="top" rows="5" name="description" cols="60"></textarea>
      </td>
      <td><input type="button" value="Preview&gt;&gt;"
	    onClick="render_text('<h2>Election description</h2>',
				 'description',
				 'rendered_description')"></td>
      <td valign="top"><span class="rendering" id="rendered_description"></span></td>
    </tr>
  </table>
  </p>

  <p>Enter the names of all the choices (candidates),
     one per line, or upload a file containing all the choices:</p>
  <p align="left">
  <table class="form">
  <tr><td>
    <textarea rows="5" name="choices" cols="60" id="choices"></textarea></td>
    <td>
      <td><input type="button" value="Preview&gt;&gt;"
	    onClick="render_list('choices', 'rendered_choices')"></td>
      <td valign="top"><span class="rendering" id="rendered_choices"></span></td>
    </tr>
  </table>
  </p>
  <p align="left"><input type=file name="choices_file"></p>
  <p>How many choices will win the election: <input type="text" name="num_winners" size="5" value="1"></p>
  <p>The e-mail addresses of up to 1000 voters, one per line
  (more voters can be added later):</p>
  <p><textarea rows="2" name="addresses" cols="50"></textarea></p>
  <p><input type=file name="addresses_file"></p>
  <p><input type="checkbox" name="public" value="yes">
  Make this a public election (voters can add themselves.
  <strong>Warning:</strong> there is only a token attempt to prevent multiple voting, based on voters' IP addresses).<br>
  <input type="checkbox" name="restrict_results" value="yes"
         onClick="rrparent.appendChild(rrcontrol);">
    Make results available only to a limited set of users (by default,
    all voters can see election results).
    <br>
    <span>
    <p class="suboption" id="rrcontrol">
    Enter email addresses of users permitted to view election results:
    (All voters can see these email addresses)
    </br>
    <textarea rows="2" name="result_addrs" cols="50"></textarea>
    </p>
    </span>
  <input type="checkbox" name="ballot_reporting" value="yes"
         onClick="rvparent.appendChild(rvcontrol);">
  Enable detailed ballot reporting. 
  Any election participant can view the rankings on each ballot
  (but <em>not</em> any identifying information about the voter) .
  <span>
  <p class="suboption" id="reveal_voters">
  <input type="checkbox" name="reveal_voters" value="yes">
  In detailed ballot report, also reveal the identity of the voter
  with each ballot.<br>Voters are <i class="warning">not</i> anonymous if this is checked,
  nor does the server discard voter email addresses as it normally does.
  </p>
  </span>
  <input type="checkbox" name="writeins" value="yes">
  Allow voters to write in new choices.<br>
  <input type="checkbox" name="shuffle" value="no">
  Present choices on voting page in exactly the given order (by default,
  they are shuffled randomly on each ballot).<br>
  <input type="checkbox" name="no_opinion" value="yes">
  Allow voters to select &ldquo;no opinion&rdquo; for some choices.<br>
  <input type="checkbox" name="proportional" value="yes"
         onClick="prparent.appendChild(prcontrol)">
  Enforce proportional representation (useful only if there is
  more than one winner [<a href="proportional.html">more information</a>])</br>
  <span>
   <p class="suboption" id="prcontrol">
    For proportional representation, voters are assumed to be maximizing:<br>
    <input type="radio" name="rating_interpretation"
       value="best_choice"
       checked> rank of their favorite choice<br>
    <input type="radio" name="rating_interpretation"
       value="combined_ratings"> combined weights of selected choices<br>
   </p>
  </span>

<div class="emphasized">
  Make sure your e-mail address is correct because election information will
  be emailed to you. Voters will not be informed of the election's
  existence until you respond to this e-mail message.
  </div>
  <p style="margin-left: 5ex">
    <input type="submit" value="Create election" name="submit">
  </p>
</form>
</div>

<script type="text/javascript">
  setup();
</script>
</body>

</html>
